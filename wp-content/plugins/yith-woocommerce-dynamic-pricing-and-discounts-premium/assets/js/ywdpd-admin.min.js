jQuery(function(a){"use strict";var e=a(document).find(".ywdpd-sections-group").find(".ywdpd-section"),t=(e.find(".yith-ywdpd-eventype-select"),"undefined"!=typeof yith_ywdpd_admin&&yith_ywdpd_admin.del_msg),i=yith_ywdpd_admin.ajaxurl+"?action=ywdpd_admin_action";a(document).on("click",".ywdpd_new_rule",function(e){e.preventDefault();var t=a(this).parent().parent().find(".discount-rules"),d=t.find(".discount-table-row"),n=1;d.each(function(){var e=a(this).data("index");n<e&&(n=e)});e=n+1,d="",d="rules-container"===t.parent().parent().parent().attr("id")?wp.template("ywdpd-quantity-discount-row"):wp.template("ywdpd-quantity-category-discount-row");a(d({index:e})).appendTo(t),a(document.body).trigger("wc-enhanced-select-init"),a(document.body).trigger("yith-framework-enhanced-select-init")}),a(document).on("click","#ywdpd_new_cart_rule",function(e){e.preventDefault();var t=a(this).parent().parent().find("#cart-rules"),d=t.find(".cart-rule-row"),n=1;d.each(function(){var e=a(this).data("index");n<e&&(n=e)});e=n+1,d=wp.template("ywdpd-cart-discount-row"),e=a(d({index:e}));show_item(e.find(".ywdpd_rule_type")),e.appendTo(t),a(document.body).trigger("wc-enhanced-select-init"),a(document.body).trigger("yith-framework-enhanced-select-init")}),a(document).on("change",".discount-table-row .ywdpd_qty_discount",function(e){var t=a(this),d=t.closest(".discount-table-row").find("span.ywdpd_symbol");"percentage"===t.val()?d.html(yith_ywdpd_admin.percent_symbol):d.html(yith_ywdpd_admin.currency_symbol)}),a(document).on("change","#_discount_rule-container select",function(e){var t=a(this),d=t.parent().parent().parent().find("span.ywdpd_symbol");"percentage"===t.val()?d.html(yith_ywdpd_admin.percent_symbol):d.html(yith_ywdpd_admin.currency_symbol)}),a(document).on("change","#_simple_whole_discount_discount_mode",function(e){var t=a(this).val(),d=a(this).parent().parent().parent().find(".ywdpd_symbol");"percentage"===t?d.html(yith_ywdpd_admin.percent_symbol):d.html(yith_ywdpd_admin.currency_symbol)});var d=a("#_simple_whole_discount_discount_mode"),n=d.val(),d=d.parent().parent().parent().find(".ywdpd_symbol");"percentage"===n?d.html(yith_ywdpd_admin.percent_symbol):d.html(yith_ywdpd_admin.currency_symbol),a(document).on("change",'#_rule_for input[type="radio"], #_rule_apply_adjustment_discount_for input[type="radio"]',function(e){o(a(this))}),a(document).on("change",'#_user_rules input[type="radio"]',function(e){c(a(this))});var r,_,o=function(e){var t=e,d=t.parent().parent().attr("id"),e=t.val();"_rule_for"===d?(t=a("#_active_exclude").parents(".the-metabox"),"specific_products"===e?(t.find('input[type="checkbox"]').is(":checked")&&t.find('input[type="checkbox"]').val("no").click(),l(t,!1)):"specific_categories"===e?(l(t,!0),l(a("#_exclude_rule_for-specific_products").parent(),!0),l(a("#_exclude_rule_for-specific_tag").parent(),!0),l(a("#_exclude_rule_for-specific_categories").parent(),!1),l(a("#_exclude_rule_for-vendor_list_excluded").parent(),!0),l(a("#_exclude_rule_for-brand_list_excluded").parent(),!0)):"specific_tag"===e?(l(t,!0),l(a("#_exclude_rule_for-specific_products").parent(),!0),l(a("#_exclude_rule_for-specific_tag").parent(),!1),l(a("#_exclude_rule_for-specific_categories").parent(),!0),l(a("#_exclude_rule_for-vendor_list_excluded").parent(),!0),l(a("#_exclude_rule_for-brand_list_excluded").parent(),!0)):"vendor_list"===e?(l(t,!0),l(a("#_exclude_rule_for-specific_products").parent(),!0),l(a("#_exclude_rule_for-specific_tag").parent(),!0),l(a("#_exclude_rule_for-specific_categories").parent(),!0),l(a("#_exclude_rule_for-vendor_list_excluded").parent(),!1),l(a("#_exclude_rule_for-brand_list_excluded").parent(),!0)):"specific_brands"===e?(l(t,!0),l(a("#_exclude_rule_for-specific_products").parent(),!0),l(a("#_exclude_rule_for-specific_tag").parent(),!0),l(a("#_exclude_rule_for-specific_categories").parent(),!0),l(a("#_exclude_rule_for-vendor_list_excluded").parent(),!0),l(a("#_exclude_rule_for-brand_list_excluded").parent(),!1)):(l(t,!0),l(a("#_exclude_rule_for-specific_products").parent(),!0),l(a("#_exclude_rule_for-specific_tag").parent(),!0),l(a("#_exclude_rule_for-specific_categories").parent(),!0),l(a("#_exclude_rule_for-vendor_list_excluded").parent(),!0),l(a("#_exclude_rule_for-brand_list_excluded").parent(),!0))):"_rule_apply_adjustment_discount_for"===d&&(d=a("#_active_apply_adjustment_to_exclude").parents(".the-metabox"),"specific_products"===e?(d.find('input[type="checkbox"]').is(":checked")&&d.find('input[type="checkbox"]').val("no").click(),l(d,!1)):"specific_categories"===e?(l(d,!0),l(a("#_exclude_apply_adjustment_rule_for-specific_products").parent(),!0),l(a("#_exclude_apply_adjustment_rule_for-specific_tag").parent(),!0),l(a("#_exclude_apply_adjustment_rule_for-specific_categories").parent(),!1)):("specific_tag"===e?(l(d,!0),l(a("#_exclude_apply_adjustment_rule_for-specific_products").parent(),!0),l(a("#_exclude_apply_adjustment_rule_for-specific_tag").parent(),!1)):(l(d,!0),l(a("#_exclude_apply_adjustment_rule_for-specific_products").parent(),!0),l(a("#_exclude_apply_adjustment_rule_for-specific_tag").parent(),!0)),l(a("#_exclude_apply_adjustment_rule_for-specific_categories").parent(),!0)))},c=function(e){var t,d,n=e,i=n.parent().parent().attr("id"),r=n.val();"_user_rules"===i&&(t=a("#_enable_user_rule_exclude").parents(".the-metabox"),d=a("#_user_rule_exclude-specific_roles").parent(),n=(e=a("#_user_rule_exclude-specific_customers")).parent(),i=a("#_user_rule_exclude-specific_membership").parent(),"customers_list"===r?(t.find('input[type="checkbox"]').is(":checked")&&t.find('input[type="checkbox"]').val("no").click(),l(t,!1)):"role_list"===r?(l(t,!0),l(d,!1),l(n,!0),l(i,!0),e.click()):"specific_membership"===r?(l(t,!0),l(d,!0),l(n,!0),l(i,!1),e.click()):(l(t,!0),l(d,!0),l(n,!0),l(i,!0)))},l=function(e,t){e.length&&(t?(e.show(),e.fadeTo("slow",1).addClass("fade-in")):e.hasClass("fade-in")?e.fadeTo("slow",0,function(){a(this).hide().removeClass("fade-in")}):(e.hide(),e.css({opacity:"0"})))};function s(e,t,d){for(var n=!0,i=0;i<t.length;i++){":radio"==t[i].substr(0,6)&&(t[i]=t[i]+":checked");var r=a(t[i]).val();if("checkbox"==a(t[i]).attr("type")&&(r=a(t[i]).is(":checked")?"yes":"no"),!n||r!=d[i]){n=!1;break}n=!0}n?a(e+"-container").parent().show():a(e+"-container").parent().hide()}a(document).on("change","#special_offer_purchase_discount",function(e){var t=a(this),d=t.parent().parent().parent().find("span.ywdpd_symbol");"percentage"===t.val()?d.html(yith_ywdpd_admin.percent_symbol):d.html(yith_ywdpd_admin.currency_symbol)}),a(document).on("click",".yith-icon.yith-icon-trash",function(){var e=a(this),t=e.closest("div.discount-table-row");t.length||(t=e.closest("div.cart-rule-row")),t.remove()}),e.find(".datepicker").each(function(){a(this).prop("placeholder","YYYY-MM-DD HH:mm")}).datetimepicker({timeFormat:"HH:mm",defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1}),a("#_discount_type").length&&(r=a("#_discount_type").data("std"),e=a(".page-title-action").attr("href"),a("#_discount_type").attr("value",r),a(".page-title-action").attr("href",e+"&ywdpd_discount_type="+r)),a("#_schedule_from, #_schedule_to").each(function(){a(this).prop("placeholder","YYYY-MM-DD HH:mm")}).datetimepicker({timeFormat:"HH:mm",defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1}),a(".post-type-ywdpd_discount table.wp-list-table").sortable({items:"tbody tr:not(.inline-edit-row)",cursor:"move",handle:".priority.column-priority",axis:"y",forcePlaceholderSize:!0,helper:"clone",opacity:.65,start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style");var d=t.item.find(".check-column input").val(),n=t.item.prev().find(".check-column input").val(),t=t.item.next().find(".check-column input").val();a.post(i,{ywdpd_action:"table_order_section",type:a(document).find("body").hasClass("ywdpd-discount-type-cart")?"cart":"pricing",roleid:d,previd:n,nextid:t},function(e){console.log(e)})}}),a("#ywdpd-discount-list-table").on("submit",function(){var e=a(this).find("#bulk-action-selector-top").val();if("delete"==e)return 1==window.confirm(t)}),a(document).on("change",".ywdpd-toggle-enabled input",function(){var e="yes"===a(this).val()?"yes":"no",t=a(this).closest(".ywdpd-toggle-enabled"),d=t.data("discount-id"),t=t.data("security");a.ajax({type:"POST",data:{ywdpd_action:"discount_toggle_enabled",id:d,enabled:e,security:t},url:i,success:function(e){"undefined"!=typeof e.error&&alert(e.error)}})}),a(document).find("body").hasClass("post-type-ywdpd_discount")&&(r=a(".subsubsub").find("li a"),p=a(".row-actions"),_="",a(document).find("body").hasClass("ywdpd-discount-type-cart")&&(_="cart"),a(document).find("body").hasClass("ywdpd-discount-type-pricing")&&(_="pricing"),0<a(document).find("#ywdpd_discount_type").length&&(_=a(document).find("#ywdpd_discount_type").val()),a.each(r,function(){var e=a(this),t=e.attr("href");t+="&ywdpd_discount_type="+_,e.attr("href",t)}),a.each(p,function(){var e=a(this).find("a");a.each(e,function(){var e=a(this),t=e.attr("href");t+="&ywdpd_discount_type="+_,e.attr("href",t)})}),0<(p=a(document).find("a.page-title-action")).length&&a.each(p,function(){var e=a(this),t=e.attr("href");t+="&ywdpd_discount_type="+_,e.attr("href",t)}),p=a(document).find("#posts-filter"),a("<input>").attr({type:"hidden",value:_,name:"ywdpd_discount_type"}).appendTo(p)),a(document).find(".ui-datepicker").addClass("yith-plugin-fw-datepicker-div"),a(".metaboxes-tab [data-dep-target]").each(function(){var e=a(this),t=e.data("dep-id").split(",");if(-1<t.constructor.toString().indexOf("Array")&&1<t.length){var d="#"+e.data("dep-target"),n=e.data("dep-value").split(",");s(d,t,n);for(var i=0;i<t.length;i++)t[i]="#"+t[i];for(i=0;i<t.length;i++)a(t[i]).on("change",function(){s(d,t,n)}).change()}}),a(document).on("change",'#schedule_mode input[type="radio"]',function(e){"no_schedule"===a(this).val()?a(document).find("#_schedule_discount_mode-container .yith-plugin-fw-field-schedule").hide():a(document).find("#_schedule_discount_mode-container .yith-plugin-fw-field-schedule").show()});var u=function(e){var t=a(document).find("#_rule_for-container label:first-child"),d=a(document).find("#_quantity_based-container label:first-child"),n=a(document).find("#_user_rules-container label:first-child"),i=a(document).find("#_schedule_discount_mode-container").closest("label"),r=a(document).find("#_table_note_apply_to-container label:first-child"),_=a(document).find("#_table_note_apply_to-container span.description"),o=a(document).find("#_enable_user_rule_exclude-container label:first-child"),c=a(document).find("#_enable_user_rule_exclude-container span.description");"exclude_items"===e&&(e="bulk"),"undefined"!=typeof yith_ywdpd_admin.labels.rule_type[e]&&("undefined"!=typeof(e=yith_ywdpd_admin.labels.rule_type[e]).rule_for&&t.html(e.rule_for.label),"undefined"!=typeof e.quantity_based&&d.html(e.quantity_based.label),"undefined"!=typeof e.user_rules&&n.html(e.user_rules.label),"undefined"!=typeof e.schedule_discount_mode&&i.html(e.schedule_discount_mode.label),"undefined"!=typeof e.table_note_apply_to&&(r.html(e.table_note_apply_to.label),_.html(e.table_note_apply_to.desc)),"undefined"!=typeof e.enable_user_rule_exclude&&(o.html(e.enable_user_rule_exclude.label),c.html(e.enable_user_rule_exclude.desc)))};a(document).on("change",'#_discount_mode-container input[type="radio"]',function(e){var t=a(this).val();u(t),"discount_whole"!==t&&"category_discount"!==t||a("#_rule_for-all_products").click(),l(a("#_exclude_rule_for-specific_categories").parent(),"category_discount"!==t)});var p,f,y=function(e,t){var d="",d=t?".yith-add-box-row":".yith-toggle-content-row",n=e.find(d).not(".ywdpd_general_rule"),i=e.find(d).find(".ywdpd_condition_for").val(),t=n.not("."+i),e=n.filter("."+i),n="";t.addClass("hide_row"),"customers"===i?(n=e.find(".user_discount_to").parents(d),h(n,e,d),n.removeClass("hide_row")):"cart_items"===i?(n=e.find(".ywdpd_cart_item_qty_type").parents(d),b(n,e,d),n.removeClass("hide_row")):"product"===i?(n=e.find(".ywdpd_product_type").parents(d),w(n,e,d),n.removeClass("hide_row")):e.removeClass("hide_row")},h=function(e,t,d){var n=t.find('.user_discount_to input[type="radio"]:checked').val(),i=t.filter("."+n);t.not("."+n).addClass("hide_row"),"all"===n?(d=i.find(".ywdpd_enable_exclude_users").parents(d),m(i),d.removeClass("hide_row")):i.removeClass("hide_row")},m=function(e){e.find('.ywdpd_enable_exclude_users input[type="checkbox"]').is(":checked")?e.filter(".customers_list_excluded").removeClass("hide_row"):e.filter(".customers_list_excluded").addClass("hide_row")},b=function(e,t,d){var n=t.find('.ywdpd_cart_item_qty_type input[type="radio"]:checked').val(),i=t.filter("."+n),n=t.not("."+n);i.removeClass("hide_row"),n.addClass("hide_row")},w=function(e,t,d){var n,i,r,_,o,c=t.find('.ywdpd_product_type input[type="radio"]:checked').val(),a=t.filter("."+c);t.not("."+c).addClass("hide_row"),"require_product"===c?(i=a.find(".ywdpd_enable_require_product").parents(d),r=a.find(".ywdpd_enable_require_product_categories").parents(d),_=a.find(".ywdpd_enable_require_product_tag").parents(d),o=a.find(".ywdpd_enable_require_product_vendors").parents(d),n=a.find(".ywdpd_enable_require_product_brands").parents(d),g(a,".ywdpd_enable_require_product",".enable_require_product_list"),g(a,".ywdpd_enable_require_product_categories",".enable_require_product_category_list"),g(a,".ywdpd_enable_require_product_tag",".enable_require_product_tag_list"),g(a,".ywdpd_enable_require_product_vendors",".enable_require_product_vendors_list"),g(a,".ywdpd_enable_require_product_brands",".enable_require_product_brands_list"),i.removeClass("hide_row"),r.removeClass("hide_row"),_.removeClass("hide_row"),o.removeClass("hide_row"),n.removeClass("hide_row")):"exclude_product"===c?(i=a.find(".ywdpd_enable_exclude_require_product").parents(d),r=a.find(".ywdpd_enable_exclude_on_sale_product").parents(d),_=a.find(".ywdpd_enable_exclude_product_categories").parents(d),o=a.find(".ywdpd_enable_exclude_product_tag").parents(d),n=a.find(".ywdpd_enable_exclude_product_vendors").parents(d),t=a.find(".ywdpd_enable_exclude_product_brands").parents(d),g(a,".ywdpd_enable_exclude_require_product",".enable_exclude_product_list"),g(a,".ywdpd_enable_exclude_product_categories",".enable_exclude_product_category_list"),g(a,".ywdpd_enable_exclude_product_tag",".enable_exclude_product_tag_list"),g(a,".ywdpd_enable_exclude_product_vendors",".enable_exclude_product_vendors_list"),g(a,".ywdpd_enable_exclude_product_brands",".enable_exclude_product_brands_list"),i.removeClass("hide_row"),r.removeClass("hide_row"),_.removeClass("hide_row"),o.removeClass("hide_row"),n.removeClass("hide_row"),t.removeClass("hide_row")):"disable_product"===c&&(i=a.find(".ywdpd_enable_disable_product").parents(d),r=a.find(".ywdpd_enable_disable_product_categories").parents(d),_=a.find(".ywdpd_enable_disable_product_tag").parents(d),o=a.find(".ywdpd_enable_disable_product_brands").parents(d),g(a,".ywdpd_enable_disable_product",".enable_disable_product_list"),g(a,".ywdpd_enable_disable_product_categories",".enable_disable_product_category_list"),g(a,".ywdpd_enable_disable_product_tag",".enable_disable_product_tag_list"),g(a,".ywdpd_enable_disable_product_brands",".enable_disable_product_brands_list"),i.removeClass("hide_row"),r.removeClass("hide_row"),_.removeClass("hide_row"),o.removeClass("hide_row"))},g=function(e,t,d){e.find(t+' input[type="checkbox"]').is(":checked")?e.filter(d).removeClass("hide_row"):e.filter(d).addClass("hide_row")};a(document).on("yith-add-box-button-toggle",function(e,t){var d=a(document).find("#_cart_discount_rules_add_box");y(d,!0)}),a(document).on("change",".ywdpd_condition_for",function(e){var t="",d=!1;a(this).parent().parent().parent().hasClass("yith-add-box-row")?(t=a("#_cart_discount_rules_add_box"),d=!0):t=a(this).closest(".yith-toggle-content"),y(t,d)}),a(document).on("change",'.user_discount_to input[type="radio"]',function(e){var t=a(this).closest("#_cart_discount_rules_add_box"),d=!0;t.length||(t=a(this).closest(".yith-toggle-content"),d=!1),y(t,d)}),a(document).on("change",'#_cart_discount_rules input[type="checkbox"]',function(e){var t=a(this).closest("#_cart_discount_rules_add_box"),d=!0;t.length||(t=a(this).closest(".yith-toggle-content"),d=!1),y(t,d)}),a(document).on("change",'.ywdpd_cart_item_qty_type input[type="radio"], .ywdpd_product_type input[type="radio"]',function(e){var t=a(this).closest("#_cart_discount_rules_add_box"),d=!0;t.length||(t=a(this).closest(".yith-toggle-content"),d=!1),y(t,d)}),a(document).on("yith-toggle-element-item-before-add",function(e,t,d,n){y(d,!1)}),a(document).on("yith-toggle-change-counter",function(e,t,d){var n;"_cart_discount_rules_add_box"===d.attr("id")&&(d=d.parents(".toggle-element").find(".yith-toggle-row"),n=0,d.each(function(){var e=a(this).data("item_key");n<e&&(n=e)}),t.val(n+1))}),a(document).on("ywdpd-init-fields",function(e){var t=a(document).find('#_discount_mode-container input[type="radio"]:checked').val();u(t),"discount_whole"!==t&&"category_discount"!==t||a("#_rule_for-all_products").click(),"no_schedule"===a(document).find('#schedule_mode input[type="radio"]:checked').val()?a(document).find("#_schedule_discount_mode-container .yith-plugin-fw-field-schedule").hide():a(document).find("#_schedule_discount_mode-container .yith-plugin-fw-field-schedule").show(),o(a(document).find('#_rule_for input[type="radio"]:checked')),o(a(document).find('#_rule_apply_adjustment_discount_for input[type="radio"]:checked')),c(a(document).find('#_user_rules input[type="radio"]:checked')),a(document).find("#_cart_discount_rules .yith-toggle-content").each(function(){y(a(this),!1)}),l(a("#_exclude_rule_for-specific_categories").parent(),"category_discount"!==t)}).trigger("ywdpd-init-fields"),a(document).find("body.ywdpd-discount-type-pricing").length&&((p=a("<div>")).attr("id","ywdpd_error_message"),p.attr("title",yith_ywdpd_admin.message_alert.title),p.append("<p>"+yith_ywdpd_admin.message_alert.desc+"</p>"),a(document).find(".wp-list-table").before(p),a("#ywdpd_error_message").on("dialogcreate",function(e,t){a(".ui-dialog-title").before('<span class="alert-rule"></span>')}),f=a("#ywdpd_error_message").dialog({resizable:!1,autoOpen:!1,height:"auto",width:400,modal:!0}),a(document).on("click",".ywdpd-alert-rule",function(e){e.preventDefault(),f.dialog({position:{my:"left center",at:"right center",of:a(this)}}),f.dialog("open")}))});