jQuery(function(o){var i=o(document).find(".ywdpd_popup"),e={message:null,overlayCSS:{background:"#fff",opacity:.6},ignoreIfBlocked:!0},a=function(){i.fadeOut(300),o(document).trigger("wc_update_cart")},p=function(d){var t=d.data("allowed_items")-1;d.data("allowed_items",t),0<t?d.find(".ywdpd_quantity").html(t):d.addClass("hide_rule"),o(document).trigger("ywdpd_counter_updated",[t,d])},u=function(){i.find(".ywdpd_step2").fadeOut(300,function(){i.find(".ywdpd_step1").fadeIn(300),i.find(".ywdpd_step2").html("")})},d=function(){var d=i.find(".ywdpd_popup_wrapper"),t=d.outerWidth(),n=d.outerHeight(),a=o(window).width(),e=o(window).height();d.css({position:"fixed",top:(e-n)/2+"px",left:(a-t)/2+"px"})};(function(){i.find(".ywdpd_product_stage").each(function(){var d=o(this).find(".ywdpd_products.owl-carousel"),t=3<(t=d.find("li").size())?3:t;d.owlCarousel({loop:!1,margin:10,nav:!1,responsive:{0:{items:1,nav:!0,navText:[]},600:{items:t},1e3:{items:t}}})})})(),setTimeout(function(){i.fadeIn(300),d()},900),i.on("click",".ywdpd_close",a),i.on("click",".ywdpd_step1 ul.ywdpd_products.products li a",function(d){d.preventDefault();var t,n=o(this).parent(),d=n.data("product_id"),a=n.data("ywdpd_rule_id");"simple"===n.data("product_type")?(t={product_id:d=n.data("product_id"),rule_id:a=n.data("ywdpd_rule_id"),action:ywdpd_popup_args.actions.add_gift_to_cart},o.ajax({type:"POST",url:ywdpd_popup_args.ajax_url,data:t,dataType:"json",beforeSend:function(){n.parents(".ywdpd_product_stage").block(e)},success:function(d){n.addClass("added"),p(o(document).find("#ywdpd_single_rule_"+a))},complete:function(){n.parents(".ywdpd_product_stage").unblock()}})):(t={product_id:d,rule_id:a,action:ywdpd_popup_args.actions.show_second_step},o.ajax({type:"POST",url:ywdpd_popup_args.ajax_url,data:t,dataType:"json",beforeSend:function(){n.find("img.ywdpd_loader").show()},success:function(d){var t;""!==d.template&&(t=d.template,i.find(".ywdpd_step1").fadeOut(300,function(){i.find(".ywdpd_step2").html(t),i.find(".ywdpd_step2 .variations_form").each(function(){o(this).wc_variation_form()}),_(),c(),i.find(".ywdpd_step2").fadeIn(300)}))},complete:function(){n.find("img.ywdpd_loader").hide()}}))});var _=function(){o(".variations_form.cart").on("found_variation",function(d,t){var n=o(this),t={ywdp_check_rule_id:o(this).parent().find(".ywdpd_rule_id").val(),product_id:t.variation_id,action:ywdpd_popup_args.actions.check_variable};o.ajax({type:"POST",url:ywdpd_popup_args.ajax_url,data:t,dataType:"json",beforeSend:function(){n.block(e)},success:function(d){d.variation_found?o(".ywdpd_add_to_gift").attr("disabled",!0):o(".ywdpd_add_to_gift").attr("disabled",!1)},complete:function(){n.unblock()}})}).on("reset_data",function(d){o(".ywdpd_add_to_gift").attr("disabled",!0)})},c=function(){o(document).on("click",".ywdpd_add_to_gift",function(d){d.preventDefault();var n,a=o('input[name="product_id"]'),t=o("input.variation_id"),d=(d=o(document).find('select[name^="attribute"]'),n={},d.each(function(){var d=o(this),t=d.attr("name");n[t]=d.val()}),n),e=o("input.ywdpd_rule_id"),d={product_id:a.val(),variation_id:t.val(),rule_id:e.val(),variations:d,action:ywdpd_popup_args.actions.add_gift_to_cart},i=o(this);o.ajax({type:"POST",url:ywdpd_popup_args.ajax_url,data:d,dataType:"json",beforeSend:function(){i.addClass("loading")},success:function(d){var t=o(document).find("#ywdpd_single_rule_"+e.val());t.find('ul.ywdpd_products li[data-product_id="'+a.val()+'"]').addClass("added"),p(t),u()},complete:function(){i.removeClass("loading")}})})};o(document).on("ywdpd_counter_updated",function(d,t,n){0==i.find(".ywdpd_single_rule_container").not(".hide_rule").size()?a():i.find(".ywdpd_single_rule_container.hide_rule").fadeOut(300)}),o(document).on("click",".ywdpd_back",function(d){u()}),o(document).on("click",".ywdpd_footer a",function(d){d.preventDefault(),a()}),o(document).on("keyup",function(d){27==d.keyCode&&a()}),o(window).on("resize",function(){d()})});